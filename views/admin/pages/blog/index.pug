extend ../../layouts/default.pug
include ../../mixins/filterStatus.pug
include ../../mixins/formSearch.pug
include ../../mixins/pagination.pug
include ../../mixins/formChangeMulti.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug
include ../../mixins/moment.pug


block main 

    if(1)
        h1 Danh sách bài viết
        +alert-success(3000)
        +alert-error(3000)
        .card.mb-3 
            .card-header Bộ lọc và Tìm kiếm 
            .card-body 
                .row 
                    .col-6
                        +filterStatus(filter)
                    .col-3
                        +formSearch(keyword)
        .card.mb-3 
            .card-header Danh sách
            .card-body
                .row 
                    .col-8
                        +formChangeMulti(`${PATH_ADMIN}/blogs/change-multi?_method=PATCH`, isDelete, "blogs", "bài viết")
                    .col-4 
                        if(1)
                            a(
                                href=`${PATH_ADMIN}/blogs/create`
                                class="btn btn-outline-success"    
                            ) Thêm mới
        .card.mb-3
            .card-header Sắp xếp 
            .card-body
                .row 
                    .col-4
                        +sort()
                table(
                    class=" table table-hover table-sm"
                    checkbox-multi
                )
                    thead 
                        tr 
                            th 
                                input(type="checkbox" name="checkall")
                            th STT 
                            th Hình ảnh 
                            th Tiêu đề
                            th Mô tả ngắn
                            th Vị trí
                            th Trạng thái 
                            th Người tạo
                            th Người chỉnh sửa
                            th Hành động
                    tbody 
                        each item, index in records
                            tr 
                                td 
                                    input(
                                        type="checkbox"
                                        name="id"
                                        value=item.id
                                    )
                                td #{(pagination.currentPage - 1) * pagination.limitItem+ (index+1)}
                                td 
                                    img(src=item.thumbnail , alt= item.title) 
                                td  #{item.title}
                                td #{item.summary}
                                td 
                                    input(
                                        type="number"
                                        value= item.position 
                                        style="witdh: 60px"
                                        min="1"
                                        name="position"
                                    )
                                td  
                                    if(role.permission.includes("blogs_edit"))
                                        if(item.status==="active")
                                            a(
                                                href="javascript:;" 
                                                data-status= item.status
                                                data-id= item.id
                                                button-change-status
                                                class="badge text-bg-success"
                                            ) Hoạt động
                                        else
                                            a(
                                                href="javascript:;"
                                                data-status=item.status
                                                data-id= item.id
                                                button-change-status 
                                                class="badge text-bg-danger"
                                            ) Không hoạt động 
                                    else 
                                        if(item.status==="active")
                                            div(
                                                class="badge text-bg-success"
                                            ) Hoạt động
                                        else
                                            div(
                                                class="badge text-bg-danger"
                                            ) Không hoạt động 
                                td 
                                    p #{item.accountFullname}
                                    p 
                                        +formatDateTime(item.createdBy.createdAt)
                                td 
                                    - const updatedBy= item.updatedBy.slice(-1)[0];
                                    - if(updatedBy)
                                        p #{updatedBy.accountFullname}
                                        p 
                                            +formatDateTime(updatedBy.updatedAt)
                                td 
                                    if(role.permission.includes("blogs_edit"))
                                        a(
                                            href=`${PATH_ADMIN}/blogs/edit/${item.id}`
                                            class="btn btn-warning btn-sm"
                                        ) Sửa
                                    if(find.deleted)
                                        button(
                                            class="btn btn-primary btn-sm ml-1"
                                            button-restore
                                            data_id= item.id    
                                        ) Khôi phục 
                                
                                    else
                                        if(role.permission.includes("blogs_delete"))
                                            button(
                                                class="btn btn-danger btn-sm ml-1"
                                                button-delete
                                                data_id= item.id    
                                            ) Xóa    
                                    a(
                                        href=`${PATH_ADMIN}/blogs/detail/${item.id}`
                                        class="btn btn-secondary btn-sm"
                                    ) Chi tiết
                                    
        +pagination(pagination)
        form(
            action= ""
            method="POST"
            id="form-change-status"
            data-path =`${PATH_ADMIN}/blogs/change-status`
        )

        form(
            action=""
            method="POST"
            id="form-delete"
            data-path=`${PATH_ADMIN}/blogs/delete`
        )
        form(
            action=""
            method="POST"
            id="form-restore"
            data-path=`${PATH_ADMIN}/blogs/restore`
        )
    else 
        h1 Bạn không có quyền truy cập trang này
    script(src="/admin/js/product.js") 